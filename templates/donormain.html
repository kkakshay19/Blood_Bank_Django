<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donor Dashboard - Blood Donor System</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  {% load static %}
  <link href="{% static 'donormain.css' %}?v=3.0" rel="stylesheet">
</head>
<body>

  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="container">
      <div class="navbar-content">
        <div class="navbar-brand">
          <div class="brand-icon">
            <i class="fas fa-heartbeat"></i>
          </div>
          <div class="brand-text">
            <h1>LifeSaver</h1>
            <span>Donor Portal</span>
          </div>
        </div>
        <div class="navbar-menu">
          <a href="{% url 'index' %}" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
          </a>
          <a href="{% url 'donor_logout' %}" class="nav-item logout">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="hero-title">Welcome Back, <span class="highlight">{{ donor_profile.full_name }}</span>!</h1>
          <p class="hero-subtitle">Every donation you make is a gift of life. Thank you for being a hero in someone's story.</p>
        </div>
        <div class="hero-badge">
          <div class="patient-status-display">
            <div class="status-icon">
              <i class="fas fa-tint"></i>
            </div>
            <div class="status-info">
              <span class="status-label">Blood Type</span>
              <span class="status-value">{{ donor_profile.blood_group }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Dashboard -->
  <section class="stats-section">
    <div class="container">
      <div class="stats-grid">
        <div class="stat-box stat-primary">
          <div class="stat-icon">
            <i class="fas fa-hand-holding-heart"></i>
          </div>
          <div class="stat-details">
            <h3 class="stat-number">{{ donations.count }}</h3>
            <p class="stat-label">Total Donations</p>
          </div>
          <div class="stat-decoration"></div>
        </div>
        <div class="stat-box stat-success">
          <div class="stat-icon">
            <i class="fas fa-droplet"></i>
          </div>
          <div class="stat-details">
            <h3 class="stat-number">{{ total_quantity }}</h3>
            <p class="stat-label">Units Donated</p>
          </div>
          <div class="stat-decoration"></div>
        </div>
        <div class="stat-box stat-warning">
          <div class="stat-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-details">
            <h3 class="stat-number">{{ donations.count|add:3 }}</h3>
            <p class="stat-label">Lives Impacted</p>
          </div>
          <div class="stat-decoration"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      
      <!-- Profile Card -->
      <section class="profile-card-section">
        <div class="section-header">
          <div class="section-title">
            <i class="fas fa-id-card"></i>
            <h2>Your Profile</h2>
          </div>
          <button class="btn-edit" onclick="alert('Edit profile functionality coming soon!')">
            <i class="fas fa-pen"></i>
            Edit Profile
          </button>
        </div>
        
        <div class="profile-card-grid">
          <!-- Personal Info Card -->
          <div class="info-card">
            <div class="info-card-header">
              <i class="fas fa-user-circle"></i>
              <h3>Personal Information</h3>
            </div>
            <div class="info-card-body">
              <div class="info-row">
                <span class="info-label">Full Name</span>
                <span class="info-value">{{ donor_profile.full_name }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Age</span>
                <span class="info-value">{{ donor_profile.age|default:"Not specified" }} years</span>
              </div>
              <div class="info-row">
                <span class="info-label">Gender</span>
                <span class="info-value">{{ donor_profile.get_gender_display|default:"Not specified" }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Blood Group</span>
                <span class="blood-badge blood-{{ donor_profile.blood_group|lower }}">{{ donor_profile.blood_group }}</span>
              </div>
            </div>
          </div>

          <!-- Contact Info Card -->
          <div class="info-card">
            <div class="info-card-header">
              <i class="fas fa-address-book"></i>
              <h3>Contact Details</h3>
            </div>
            <div class="info-card-body">
              <div class="info-row">
                <span class="info-label"><i class="fas fa-phone"></i> Phone</span>
                <span class="info-value">{{ donor_profile.contact_number|default:"Not provided" }}</span>
              </div>
              <div class="info-row">
                <span class="info-label"><i class="fas fa-map-marker-alt"></i> Address</span>
                <span class="info-value">{{ donor_profile.address|default:"Not provided" }}</span>
              </div>
            </div>
          </div>

          <!-- Health Info Card -->
          <div class="info-card">
            <div class="info-card-header">
              <i class="fas fa-heartbeat"></i>
              <h3>Health Information</h3>
            </div>
            <div class="info-card-body">
              <div class="info-row">
                <span class="info-label">Height</span>
                <span class="info-value">{{ donor_profile.height|default:"Not specified" }} cm</span>
              </div>
              <div class="info-row">
                <span class="info-label">Weight</span>
                <span class="info-value">{{ donor_profile.weight|default:"Not specified" }} kg</span>
              </div>
              <div class="info-row">
                <span class="info-label">Medical Conditions</span>
                <span class="info-value">{{ donor_profile.medical_conditions|default:"None reported" }}</span>
              </div>
            </div>
          </div>

          <!-- Account Info Card -->
          <div class="info-card">
            <div class="info-card-header">
              <i class="fas fa-shield-alt"></i>
              <h3>Account Status</h3>
            </div>
            <div class="info-card-body">
              <div class="info-row">
                <span class="info-label">Member Since</span>
                <span class="info-value">{{ donor_profile.created_at|date:"M j, Y" }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Last Updated</span>
                <span class="info-value">{{ donor_profile.updated_at|date:"M j, Y" }}</span>
              </div>
              <div class="info-row">
                <span class="info-label">Profile Status</span>
                <span class="badge-success"><i class="fas fa-check-circle"></i> Complete</span>
              </div>
            </div>
          </div>
        </div>
      </section>


      <!-- Action Tabs -->
      <section class="action-section">
        <div class="tab-navigation">
          <button class="tab-btn active" onclick="switchTab('donation-form', this)">
            <i class="fas fa-plus-circle"></i>
            <span>Log Donation</span>
          </button>
          <button class="tab-btn" onclick="switchTab('donation-history', this)">
            <i class="fas fa-history"></i>
            <span>Donation History</span>
          </button>
        </div>

        <!-- Log Donation Tab -->
        <div id="donation-form" class="tab-content active">
          <div class="content-card">
            <div class="content-header">
              <div class="content-icon">
                <i class="fas fa-heart-pulse"></i>
              </div>
              <div class="content-title">
                <h3>Log Your Recent Donation</h3>
                <p>Help us track your contribution and save lives together</p>
              </div>
            </div>
            {% if not can_donate %}
            <div class="alert alert-warning">
              <i class="fas fa-exclamation-triangle"></i>
              <p>{{ restriction_message }}</p>
            </div>
            {% else %}
            <form method="post" class="request-form">
              {% csrf_token %}
              <div class="form-grid">
                <div class="form-field">
                  <label for="{{ donation_form.quantity.id_for_label }}">
                    <i class="fas fa-flask"></i>
                    {{ donation_form.quantity.label }}
                  </label>
                  {{ donation_form.quantity }}
                </div>
                <div class="form-field">
                  <label for="{{ donation_form.donation_date.id_for_label }}">
                    <i class="fas fa-calendar-day"></i>
                    {{ donation_form.donation_date.label }}
                  </label>
                  {{ donation_form.donation_date }}
                </div>
              </div>
              <button type="submit" name="donation" class="btn-primary">
                <i class="fas fa-save"></i>
                Request Donation Approval
              </button>
            </form>
            {% endif %}

            <!-- Booking Form (shown after initial approval) -->
            {% if approved_donations %}
            <div class="booking-section">
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <p><strong>Great news!</strong> Your donation request has been initially approved. You can now book your appointment slot.</p>
              </div>
              <h4>Book Your Appointment</h4>
              <form method="post" class="request-form">
                {% csrf_token %}
                <input type="hidden" name="booking" value="1">
                <div class="form-grid">
                  <div class="form-field">
                    <label for="{{ booking_form.timeslot.id_for_label }}">
                      <i class="fas fa-clock"></i>
                      {{ booking_form.timeslot.label }}
                    </label>
                    {{ booking_form.timeslot }}
                  </div>
                </div>
                <button type="submit" class="btn-primary">
                  <i class="fas fa-calendar-check"></i>
                  Confirm Appointment
                </button>
              </form>
              {% if available_timeslots %}
              <div class="available-slots">
                <h4>Available Timeslots</h4>
                <div class="slots-grid">
                  {% for slot in available_timeslots %}
                  <div class="slot-card">
                    <div class="slot-date">{{ slot.date|date:"M d, Y" }}</div>
                    <div class="slot-time">{{ slot.start_time }} - {{ slot.end_time }}</div>
                    <div class="slot-capacity">{{ slot.available_slots }} slots left</div>
                  </div>
                  {% endfor %}
                </div>
              </div>
              {% endif %}
            </div>
            {% endif %}
          </div>
        </div>


        <!-- Donation History Tab -->
        <div id="donation-history" class="tab-content">
          <div class="content-card">
            <div class="content-header">
              <div class="content-icon">
                <i class="fas fa-clock-rotate-left"></i>
              </div>
              <div class="content-title">
                <h3>Your Donation Journey</h3>
                <p>Track every life-saving contribution you've made</p>
              </div>
            </div>
            <div class="table-wrapper">
              <table class="modern-table">
                <thead>
                  <tr>
                    <th><i class="fas fa-hashtag"></i> ID</th>
                    <th><i class="fas fa-droplet"></i> Quantity</th>
                    <th><i class="fas fa-calendar"></i> Date</th>
                    <th><i class="fas fa-clock"></i> Timeslot</th>
                    <th><i class="fas fa-info-circle"></i> Status</th>
                  </tr>
                </thead>
                <tbody>
                  {% for donation in donations %}
                  <tr>
                    <td><span class="request-id">#{{ donation.id }}</span></td>
                    <td><strong>{{ donation.quantity }}</strong> units</td>
                    <td>{{ donation.donation_date|date:"M d, Y" }}</td>
                    <td>
                      {% if donation.timeslot %}
                        {{ donation.timeslot.date|date:"M d" }} {{ donation.timeslot.start_time }}
                      {% else %}
                        <span class="text-muted">-</span>
                      {% endif %}
                    </td>
                    <td>
                      <span class="status-pill status-{{ donation.status }}">
                        {% if donation.status == 'pending_initial' %}
                          <i class="fas fa-clock"></i> Pending Initial Approval
                        {% elif donation.status == 'initial_approved' %}
                          <i class="fas fa-check"></i> Can Book Slot
                        {% elif donation.status == 'slot_confirmed' %}
                          <i class="fas fa-calendar-check"></i> Slot Confirmed
                        {% elif donation.status == 'final_approved' %}
                          <i class="fas fa-check-double"></i> Completed
                        {% elif donation.status == 'rejected' %}
                          <i class="fas fa-times"></i> Rejected
                        {% else %}
                          {{ donation.get_status_display }}
                        {% endif %}
                      </span>
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="5" class="empty-state">
                      <div class="empty-icon">
                        <i class="fas fa-inbox"></i>
                      </div>
                      <h4>No Donations Yet</h4>
                      <p>Start your journey as a lifesaver by logging your first donation!</p>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Recent Notifications Section -->
      <section class="notifications-section">
        <div class="section-header">
          <div class="section-title">
            <i class="fas fa-bell"></i>
            <h2>Recent Notifications</h2>
          </div>
        </div>
        <div class="notifications-list">
          {% for notification in notifications %}
          <div class="notification-card">
            <div class="notification-icon">
              <i class="fas fa-info-circle"></i>
            </div>
            <div class="notification-content">
              <h4>{{ notification.title|default:"Notification" }}</h4>
              <p>{{ notification.message }}</p>
              <span class="notification-date">{{ notification.created_at|date:"M d, Y H:i" }}</span>
            </div>
            <div class="notification-actions">
              {% if not notification.is_read %}
              <a href="{% url 'mark_notification_read' notification.id %}" class="btn-small">Mark as Read</a>
              {% endif %}
            </div>
          </div>
          {% empty %}
          <div class="empty-state">
            <div class="empty-icon">
              <i class="fas fa-bell-slash"></i>
            </div>
            <h4>No Notifications</h4>
            <p>You have no new notifications.</p>
          </div>
          {% endfor %}
        </div>
      </section>

      <!-- Tips Section -->
      <section class="tips-section">
        <div class="section-header centered">
          <div class="section-title">
            <i class="fas fa-lightbulb"></i>
            <h2>Donation Guidelines</h2>
          </div>
          <p>Essential tips for a safe and successful donation experience</p>
        </div>
        
        <div class="tips-grid">
          <div class="tip-card tip-before">
            <div class="tip-icon">
              <i class="fas fa-utensils"></i>
            </div>
            <h4>Before Donating</h4>
            <ul>
              <li>Eat a healthy meal 2-3 hours before</li>
              <li>Stay well hydrated</li>
              <li>Avoid fatty foods</li>
              <li>Get a good night's sleep</li>
            </ul>
          </div>
          
          <div class="tip-card tip-during">
            <div class="tip-icon">
              <i class="fas fa-clipboard-check"></i>
            </div>
            <h4>Eligibility Criteria</h4>
            <ul>
              <li>Age: 18-65 years old</li>
              <li>Weight: At least 50kg</li>
              <li>Good general health</li>
              <li>Wait 90 days between donations</li>
            </ul>
          </div>
          
          <div class="tip-card tip-after">
            <div class="tip-icon">
              <i class="fas fa-glass-water"></i>
            </div>
            <h4>After Donation</h4>
            <ul>
              <li>Drink plenty of fluids</li>
              <li>Avoid alcohol for 24 hours</li>
              <li>Rest and avoid strenuous activities</li>
              <li>Keep the bandage on for 4-6 hours</li>
            </ul>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <p>&copy; 2024 LifeSaver Blood Donation System. Saving lives, one donation at a time.</p>
        <a href="{% url 'index' %}" class="footer-link">
          <i class="fas fa-arrow-left"></i>
          Back to Home
        </a>
      </div>
    </div>
  </footer>

  <script>
    function switchTab(tabId, button) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Remove active class from all buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(tabId).classList.add('active');
      
      // Add active class to clicked button
      button.classList.add('active');
    }
  </script>

</body>
</html>
